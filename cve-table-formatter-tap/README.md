# CVE table formatter

This script takes in an HTML table of CVEs (without indentations) and outputs a table that
meets the TAP release notes standard (orders components in alphabetical order,
creates expandable sections for the CVE lists, and creates links for each CVE).

## Prerequisites

Before you use this script, make sure you have cloned the [docs-utility-scripts](https://github.com/pivotal-cf-experimental/docs-utility-scripts/) repo to your local machine.

## Instructions

1. Pull any updates to the `cve_table_formatter.sh` script to your local machine.

    ```
    cd ~/workspace/docs-utility-scripts
    git pull
    ```

1. Open the release notes you want to edit.

1. Copy the Markdown table of CVEs from this [Concourse pipeline](https://tpe-concourse-rock.eng.vmware.com/teams/tap-security-tools/pipelines/tap-cves/jobs/fixes-diff/builds/latest).

1. Paste the table into the Markdown to [HTML converter tool](https://markdowntohtml.com/).
   Example table after conversion to HTML:

    ```html
    <table>
    <thead>
    <tr>
    <th>Package name</th>
    <th>Vulnerabilities resolved</th>
    </tr>
    </thead>
    <tbody>
    <tr>
    <td>PACKAGE-B.tanzu.vmware.com</td>
    <td><ul>
    <li>GHSA-xxxx-xxxx-xxxx</li>
    <li>CVE-2023-12345</li>
    </ul></td>
    </tr>
    <td>PACKAGE-A.tanzu.vmware.com</td>
    <td><ul>
    <li>GHSA-xxxx-xxxx-xxxx</li>
    <li>CVE-2023-12345</li>
    </ul></td>
    </tr>
    </tbody>
    </table>
    ```

1. In the directory containing `cve_table_formatter.sh`, open `cve_table_input.txt`.

1. Paste the HTML table in `cve_table_input.txt` and then save the file.

1. Run `cve_table_formatter.sh`:

    ```
    cd ~/workspace/docs-utility-scripts/cve_table_formatter-tap
    bash cve_table_formatter.sh
    ```

    The script creates an output file called `cve_table_output.txt`.

1. Open the `cve_table_output.txt` file, which contains the HTML table of CVEs
   formatted to meet the Tanzu Application Platform release notes standard.

1. Copy this output and paste it in the release notes, replacing the original Markdown table.

   Example output contents:

    ```html
    <table>
    <thead>
    <tr>
    <th>Package name</th>
    <th>Vulnerabilities resolved</th>
    </tr>
    </thead>
    <tbody>
    <tr>
    <td>PACKAGE-A.tanzu.vmware.com</td>
    <td><details><summary>Expand to see the list</summary><ul>
    <li><a href="https://github.com/advisories/GHSA-xxxx-xxxx-xxxx">GHSA-xxxx-xxxx-xxxx</a></li>
    <li><a href="https://nvd.nist.gov/vuln/detail/CVE-2023-12345">CVE-2023-12345</a></li>
    </ul></details></td>
    </tr>
    <tr>
    <td>PACKAGE-B.tanzu.vmware.com</td>
    <td><details><summary>Expand to see the list</summary><ul>
    <li><a href="https://github.com/advisories/GHSA-xxxx-xxxx-xxxx">GHSA-xxxx-xxxx-xxxx</a></li>
    <li><a href="https://nvd.nist.gov/vuln/detail/CVE-2023-12345">CVE-2023-12345</a></li>
    </ul></details></td>
    </tr>
    </tbody>
    </table>
    ```
